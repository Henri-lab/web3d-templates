# ä¸­å°ç³»ç»Ÿæ¶æ„è®¾è®¡

> History3D Learning Platform - é…ç½®é©±åŠ¨çš„æ¨¡å—åŒ–ä¸­å°ç³»ç»Ÿ

## ğŸ“– æ¦‚è¿°

History3D Learning Platform æ˜¯ä¸€ä¸ªåŸºäºé…ç½®é©±åŠ¨ã€çŠ¶æ€ç®¡ç†ã€äº‹ä»¶æ€»çº¿çš„ç°ä»£åŒ–ä¸­å°ç³»ç»Ÿã€‚é‡‡ç”¨æ¨¡å—åŒ–æ¶æ„ï¼Œæ”¯æŒå¤šä¸ªä¸šåŠ¡æ¨¡å—çš„ç‹¬ç«‹å¼€å‘ã€éƒ¨ç½²å’Œçƒ­æ’æ‹”ã€‚

### æ ¸å¿ƒç‰¹æ€§

- âœ… **é…ç½®é©±åŠ¨** - æ‰€æœ‰æ¨¡å—é€šè¿‡é…ç½®æ–‡ä»¶æ³¨å†Œå’Œç®¡ç†
- âœ… **çŠ¶æ€ç®¡ç†** - ä½¿ç”¨ Zustand å®ç°è½»é‡çŠ¶æ€ç®¡ç†
- âœ… **äº‹ä»¶æ€»çº¿** - æ¨¡å—é—´é€šè¿‡äº‹ä»¶è§£è€¦é€šä¿¡
- âœ… **æ¨¡å—æ¥å…¥** - æ”¯æŒæœ¬åœ°æ¨¡å—ã€è¿œç¨‹æ¨¡å—ï¼ˆModule Federationï¼‰ã€iframe ç­‰å¤šç§æ¥å…¥æ–¹å¼
- âœ… **ç±»å‹å®‰å…¨** - å®Œæ•´çš„ TypeScript ç±»å‹ç³»ç»Ÿ
- âœ… **ç‹¬ç«‹éƒ¨ç½²** - æ¯ä¸ªæ¨¡å—å¯ä»¥ç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½²
- âœ… **çƒ­æ’æ‹”** - æ”¯æŒæ¨¡å—åŠ¨æ€åŠ è½½å’Œå¸è½½

## ğŸ—ï¸ æ•´ä½“æ¶æ„

### æ¶æ„åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åº”ç”¨å±‚ (Application)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  React åº”ç”¨ + React Router                          â”‚    â”‚
â”‚  â”‚  - è·¯ç”±ç®¡ç†                                          â”‚    â”‚
â”‚  â”‚  - é¡µé¢æ¸²æŸ“                                          â”‚    â”‚
â”‚  â”‚  - UI ç»„ä»¶                                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¹³å°å±‚ (Platform)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  PlatformProvider (React Context)                   â”‚    â”‚
â”‚  â”‚  - å¹³å°åˆå§‹åŒ–                                        â”‚    â”‚
â”‚  â”‚  - ä¸Šä¸‹æ–‡æä¾›                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                            â†“                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  å¹³å°æ ¸å¿ƒ (Platform Core)                           â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚ PlatformAPI  â”‚  â”‚  EventBus    â”‚  â”‚  Store   â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚    â”‚
â”‚  â”‚  â”‚ModuleRegistryâ”‚  â”‚Configuration â”‚               â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¨¡å—å±‚ (Modules)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  é¦–é¡µ    â”‚  â”‚ å†å²æ•…äº‹  â”‚  â”‚ å®éªŒå®¤   â”‚  â”‚  åœ°çƒ    â”‚   â”‚
â”‚  â”‚ Welcome  â”‚  â”‚  Story   â”‚  â”‚   Lab    â”‚  â”‚  Earth   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚  â”‚ å¹³å°ç®¡ç†  â”‚                                              â”‚
â”‚  â”‚ Platform â”‚                                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PlatformProvider                        â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              initializePlatform()                   â”‚    â”‚
â”‚  â”‚                      â”‚                              â”‚    â”‚
â”‚  â”‚                      â†“                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚         åˆ›å»ºå¹³å°å®ä¾‹                      â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  Zustand   â”‚  â”‚ EventBus   â”‚         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  â”‚   Store    â”‚  â”‚            â”‚         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚         â”‚                â”‚               â”‚     â”‚    â”‚
â”‚  â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚     â”‚    â”‚
â”‚  â”‚  â”‚                  â†“                       â”‚     â”‚    â”‚
â”‚  â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚     â”‚    â”‚
â”‚  â”‚  â”‚         â”‚ ModuleRegistry â”‚              â”‚     â”‚    â”‚
â”‚  â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚     â”‚    â”‚
â”‚  â”‚  â”‚                  â”‚                       â”‚     â”‚    â”‚
â”‚  â”‚  â”‚                  â†“                       â”‚     â”‚    â”‚
â”‚  â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚     â”‚    â”‚
â”‚  â”‚  â”‚         â”‚  PlatformAPI   â”‚              â”‚     â”‚    â”‚
â”‚  â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â”‚                      â”‚                              â”‚    â”‚
â”‚  â”‚                      â†“                              â”‚    â”‚
â”‚  â”‚              è¿”å›å¹³å°å®ä¾‹                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                      â”‚                                      â”‚
â”‚                      â†“                                      â”‚
â”‚              é€šè¿‡ Context æä¾›ç»™å­ç»„ä»¶                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ æ ¸å¿ƒæµç¨‹

### 1. å¹³å°å¯åŠ¨æµç¨‹

```
1. åº”ç”¨å¯åŠ¨ (main.tsx)
   â†“
2. æ¸²æŸ“ PlatformProvider
   â†“
3. è°ƒç”¨ initializePlatform()
   â”œâ”€ åˆ›å»º Zustand Store
   â”œâ”€ åˆ›å»º EventBus
   â”œâ”€ åŠ è½½é…ç½®æ–‡ä»¶
   â””â”€ åˆ›å»ºå¹³å°å®ä¾‹
   â†“
4. æ³¨å†Œæ‰€æœ‰æ¨¡å—
   â”œâ”€ éå† moduleConfigs
   â”œâ”€ å‘é€ MODULE_REGISTER äº‹ä»¶
   â””â”€ æ·»åŠ åˆ° loadedModules
   â†“
5. è®¾ç½®å¹³å°å°±ç»ª
   â”œâ”€ è°ƒç”¨ store.setReady()
   â””â”€ å‘é€ PLATFORM_READY äº‹ä»¶
   â†“
6. æ¸²æŸ“åº”ç”¨
   â”œâ”€ æ¸²æŸ“è·¯ç”±
   â””â”€ æ¸²æŸ“æ¨¡å—é¡µé¢
```

### 2. æ¨¡å—åŠ è½½æµç¨‹

```
1. ç”¨æˆ·è®¿é—®æ¨¡å—è·¯ç”±
   â†“
2. React Router åŒ¹é…è·¯ç”±
   â†“
3. æŸ¥æ‰¾æ¨¡å—é…ç½®
   â”œâ”€ ä» moduleConfigs æŸ¥æ‰¾
   â””â”€ éªŒè¯æ¨¡å—ç±»å‹
   â†“
4. åŠ è½½æ¨¡å—ç»„ä»¶
   â”œâ”€ local: ç›´æ¥å¯¼å…¥
   â”œâ”€ remote: Module Federation åŠ è½½
   â””â”€ iframe: åˆ›å»º iframe
   â†“
5. æ‰§è¡Œç”Ÿå‘½å‘¨æœŸé’©å­
   â”œâ”€ beforeLoad
   â”œâ”€ onLoad
   â””â”€ onMount
   â†“
6. æ¸²æŸ“æ¨¡å—é¡µé¢
   â”œâ”€ å‘é€ MODULE_MOUNT äº‹ä»¶
   â””â”€ è®¾ç½® activeModule
```

### 3. æ¨¡å—é€šä¿¡æµç¨‹

```
æ¨¡å— A                    äº‹ä»¶æ€»çº¿                    æ¨¡å— B
  â”‚                         â”‚                         â”‚
  â”‚  emit('story:play')     â”‚                         â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚
  â”‚                         â”‚                         â”‚
  â”‚                         â”‚  on('story:play')       â”‚
  â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                         â”‚                         â”‚
  â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                         â”‚   handler executed      â”‚
  â”‚                         â”‚                         â”‚
  â”‚  emit('story:ended')    â”‚                         â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                         â”‚                         â”‚
```

## ğŸ“‚ ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ platform/                        # å¹³å°æ ¸å¿ƒ
â”‚   â”œâ”€â”€ config/                      # é…ç½®ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ platform.config.ts       # å¹³å°é…ç½®
â”‚   â”‚   â””â”€â”€ types.ts                 # ç±»å‹å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                        # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ platform.ts              # å¹³å°åˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ platformStore.ts         # çŠ¶æ€ç®¡ç† (Zustand)
â”‚   â”‚   â”œâ”€â”€ eventBus.ts              # äº‹ä»¶æ€»çº¿
â”‚   â”‚   â”œâ”€â”€ moduleRegistry.ts        # æ¨¡å—æ³¨å†Œä¸­å¿ƒ
â”‚   â”‚   â”œâ”€â”€ platformAPI.ts           # å¹³å° API
â”‚   â”‚   â””â”€â”€ index.ts                 # ç»Ÿä¸€å¯¼å‡º
â”‚   â”‚
â”‚   â”œâ”€â”€ PlatformProvider.tsx         # å¹³å° Provider
â”‚   â”œâ”€â”€ pages/                       # å¹³å°é¡µé¢
â”‚   â”‚   â””â”€â”€ PlatformHomePage.tsx     # å¹³å°ç®¡ç†é¡µ
â”‚   â””â”€â”€ examples/                    # ç¤ºä¾‹ä»£ç 
â”‚       â””â”€â”€ ExamplesPage.tsx         # API æ¼”ç¤ºé¡µ
â”‚
â”œâ”€â”€ pages/                           # ä¸šåŠ¡é¡µé¢
â”‚   â”œâ”€â”€ WelcomePage.tsx              # é¦–é¡µ
â”‚   â”œâ”€â”€ StorySelectionPage.tsx       # æ•…äº‹é€‰æ‹©
â”‚   â”œâ”€â”€ StoryPlayerPage.tsx          # æ•…äº‹æ’­æ”¾
â”‚   â”œâ”€â”€ ComponentLabPage.tsx         # ç»„ä»¶å®éªŒå®¤
â”‚   â””â”€â”€ EarthLabPage.tsx             # åœ°çƒå¯è§†åŒ–
â”‚
â”œâ”€â”€ components/                      # å…±äº«ç»„ä»¶
â”‚   â”œâ”€â”€ ui/                          # UI ç»„ä»¶
â”‚   â”œâ”€â”€ three/                       # Three.js ç»„ä»¶
â”‚   â””â”€â”€ layout/                      # å¸ƒå±€ç»„ä»¶
â”‚
â”œâ”€â”€ stores/                          # çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ appStore.ts                  # åº”ç”¨çŠ¶æ€
â”‚
â”œâ”€â”€ dsl/                             # DSL è§£æå™¨
â”‚   â”œâ”€â”€ parser/                      # è§£æå™¨
â”‚   â””â”€â”€ types/                       # ç±»å‹å®šä¹‰
â”‚
â”œâ”€â”€ animations/                      # åŠ¨ç”»
â”œâ”€â”€ assets/                          # é™æ€èµ„æº
â”œâ”€â”€ hooks/                           # è‡ªå®šä¹‰ Hooks
â”œâ”€â”€ utils/                           # å·¥å…·å‡½æ•°
â”œâ”€â”€ types/                           # ç±»å‹å®šä¹‰
â”œâ”€â”€ styles/                          # æ ·å¼æ–‡ä»¶
â”‚
â”œâ”€â”€ App.tsx                          # åº”ç”¨å…¥å£
â””â”€â”€ main.tsx                         # ä¸»å…¥å£
```

## ğŸ¯ è®¾è®¡åŸåˆ™

### 1. é…ç½®é©±åŠ¨ (Configuration-Driven)

æ‰€æœ‰æ¨¡å—é€šè¿‡é…ç½®æ–‡ä»¶æ³¨å†Œï¼Œé¿å…ç¡¬ç¼–ç ã€‚

```typescript
// platform.config.ts
export const moduleConfigs: ModuleConfig[] = [
  {
    id: 'story',
    name: 'å†å²æ•…äº‹',
    type: 'local',
    routes: [{ path: '/stories', component: 'StorySelectionPage' }],
    menu: { title: 'å†å²æ•…äº‹', icon: 'book', order: 1 },
    // ...
  },
]
```

### 2. æ¨¡å—è§£è€¦ (Module Decoupling)

æ¨¡å—é—´é€šè¿‡äº‹ä»¶æ€»çº¿é€šä¿¡ï¼Œä¸ç›´æ¥ä¾èµ–ã€‚

```typescript
// æ¨¡å— A
eventBus.emit('story:play', { storyId: 'qin-unification' })

// æ¨¡å— B
eventBus.on('story:play', (event) => {
  playStory(event.payload.storyId)
})
```

### 3. ç±»å‹å®‰å…¨ (Type Safety)

å®Œæ•´çš„ TypeScript ç±»å‹ç³»ç»Ÿï¼Œç¡®ä¿å¼€å‘æ—¶çš„ç±»å‹å®‰å…¨ã€‚

```typescript
export interface ModuleConfig {
  id: string
  name: string
  type: 'local' | 'remote' | 'iframe'
  routes: RouteConfig[]
  // ...
}
```

### 4. å•ä¸€èŒè´£ (Single Responsibility)

æ¯ä¸ªæ¨¡å—ã€ç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªæ˜ç¡®çš„åŠŸèƒ½ã€‚

```typescript
// âœ… å¥½çš„è®¾è®¡
class EventBus {
  emit() {}
  on() {}
  off() {}
}

// âŒ ä¸å¥½çš„è®¾è®¡
class Platform {
  emit() {}
  on() {}
  loadModule() {}
  renderPage() {}
  // èŒè´£è¿‡å¤š
}
```

### 5. å¼€é—­åŸåˆ™ (Open-Closed Principle)

å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚

```typescript
// æ·»åŠ æ–°æ¨¡å—ï¼šåªéœ€æ·»åŠ é…ç½®ï¼Œæ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç 
export const moduleConfigs: ModuleConfig[] = [
  // ç°æœ‰æ¨¡å—
  { id: 'story', ... },
  { id: 'lab', ... },

  // æ–°æ¨¡å—ï¼šåªéœ€æ·»åŠ é…ç½®
  { id: 'newModule', ... },
]
```

## ğŸ”§ æ ¸å¿ƒæŠ€æœ¯

### çŠ¶æ€ç®¡ç† - Zustand

```typescript
import { create } from 'zustand'

export const usePlatformStore = create<PlatformState>((set) => ({
  status: 'initializing',
  loadedModules: [],
  setReady: () => set({ status: 'ready' }),
  addLoadedModule: (id) =>
    set((state) => ({
      loadedModules: [...state.loadedModules, id],
    })),
}))
```

### äº‹ä»¶æ€»çº¿ - EventEmitter3

```typescript
import EventEmitter from 'eventemitter3'

export class EventBus {
  private emitter = new EventEmitter()

  emit(type: string, payload?: any) {
    this.emitter.emit(type, { type, payload, timestamp: Date.now() })
  }

  on(type: string, handler: EventHandler) {
    this.emitter.on(type, handler)
    return () => this.emitter.off(type, handler)
  }
}
```

### æ¨¡å—æ³¨å†Œ - é…ç½®é©±åŠ¨

```typescript
export async function initializePlatform() {
  // æ³¨å†Œæ‰€æœ‰æ¨¡å—
  for (const module of moduleConfigs) {
    console.log(`[Platform] Registered module: ${module.id}`)
    globalEventBus.emit(PlatformEvents.MODULE_REGISTER, { moduleId: module.id })
    store.getState().addLoadedModule(module.id)
  }

  // è®¾ç½®å°±ç»ª
  store.getState().setReady()
  globalEventBus.emit(PlatformEvents.PLATFORM_READY)
}
```

## ğŸ“Š æ•°æ®æµ

### å•å‘æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·æ“ä½œ                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è§¦å‘äº‹ä»¶/åŠ¨ä½œ                         â”‚
â”‚  eventBus.emit() / store.setXxx()                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ›´æ–°çŠ¶æ€                              â”‚
â”‚  store.setState() / eventBus.trigger()                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç»„ä»¶é‡æ¸²æŸ“                            â”‚
â”‚  React re-render                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UI æ›´æ–°                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ æ‰©å±•æ€§

### 1. æ·»åŠ æ–°æ¨¡å—

åªéœ€åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ¨¡å—é…ç½®ï¼š

```typescript
// platform.config.ts
export const moduleConfigs: ModuleConfig[] = [
  // ... ç°æœ‰æ¨¡å—
  {
    id: 'newModule',
    name: 'æ–°æ¨¡å—',
    type: 'local',
    routes: [{ path: '/new', component: 'NewPage' }],
    menu: { title: 'æ–°æ¨¡å—', icon: 'star', order: 10 },
    // ...
  },
]
```

### 2. æ·»åŠ æ–°äº‹ä»¶

åœ¨äº‹ä»¶æ€»çº¿ä¸­å®šä¹‰æ–°äº‹ä»¶ç±»å‹ï¼š

```typescript
// eventBus.ts
export const PlatformEvents = {
  // ... ç°æœ‰äº‹ä»¶
  NEW_EVENT: 'new:event',
}
```

### 3. æ·»åŠ æ–°çŠ¶æ€

åœ¨ store ä¸­æ·»åŠ æ–°çŠ¶æ€å’ŒåŠ¨ä½œï¼š

```typescript
// platformStore.ts
export const usePlatformStore = create<PlatformState>((set) => ({
  // ... ç°æœ‰çŠ¶æ€
  newState: null,
  setNewState: (value) => set({ newState: value }),
}))
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹](./QUICK-START.md)
- [æŠ€æœ¯æ ˆè¯´æ˜](./TECH-STACK.md)
- [æœ¯è¯­è¡¨](./GLOSSARY.md)
- [å¹³å°æ ¸å¿ƒç³»ç»Ÿ](../01-platform-core/README.md)
- [æ¨¡å—å¼€å‘æŒ‡å—](../02-module-development/README.md)

---

**æœ€åæ›´æ–°**: 2026-01-10
